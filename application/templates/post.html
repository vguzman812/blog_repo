{% extends 'layout.html' %}

{% block head %}
{% assets "css_bootstrap" %}
<link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}"/>
{% endassets %}
{% assets "css_main" %}
<link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}"/>
{% endassets %}
{% assets "css_post" %}
<link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}"/>
{% endassets %}
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<body>
{% include 'nav.html' %}
{% from 'bootstrap5/form.html' import render_field, render_hidden_errors %}


<div class="">
    <article class="container">
        <header class="row text-center text-quaternary-color mt-5">
            <h1 class="">
                {{post.title}}
            </h1>
            <h3>
                {{post.subtitle}}
            </h3>
        </header>
        <div class="row justify-content-center my-3 pb-5">
            <img class="col-9" src="{{ post.img_url }}" alt="">
        </div>
        <div class="row text-start text-quaternary-color justify-content-center">
            <div class="col-10">{{ post.body|safe }}</div>
        </div>
        {% if current_user.id == post.author_id %}
        <div class="row justify-content-center my-5">
            <a class=" col-2 btn btn-primary"
               href="{{ url_for('main_bp.edit_post', post_id=post.id) }}">
                Edit Post
            </a>
        </div>
        {% endif %}
    </article>
    <!--           Comments Area -->

    {{ ckeditor.load() }}
    {{ ckeditor.config(name='comment_text') }}
    <form method="POST"
          class="container text-center text-quaternary-color shadow rounded p-3 my-5">
        {% for message in get_flashed_messages() %}
        <div class="mb-3">
            <p class="text-warning">{{ message }}</p>
        </div>
        {% endfor %}
        {{ form.csrf_token }}
        {{ render_hidden_errors(form) }}
        {{ form.post_id(value=post.id) }}

        <div class="row mb-4 justify-content-center">
            <div class="col">{{ render_field(form.comment_text) }}</div>
        </div>

        <div class="row justify-content-center">
            <div class="mb-3">{{ render_field(form.submit) }}</div>
        </div>
    </form>


    <div class="col-lg-8 col-md-10 mx-auto text-quaternary-colortext-center">
        <ul>
            {% for comment in post.comments: %}
            <li class="d-flex align-items-center justify-content-evenly bg-secondary-color rounded shadow my-3 row">
                <div class=" col-2 commenterImage bg-ter">
                </div>
                <div class="comment-text py-3 col-6">
                    {{comment.text|safe}}
                </div>
                <div class="py-3 col-3"> By: {{comment.comment_author.username}}</div>
                {% if current_user.id == comment.author_id %}
                <div class="row justify-content-center">
                    <button class="col-3 btn btn-primary my-3">
                        Delete Comment
                    </button>
                </div>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

</div>

{% include 'footer.html' %}
{% endblock %}

{% block scripts %}
{% assets "js_post" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
{% endblock %}
